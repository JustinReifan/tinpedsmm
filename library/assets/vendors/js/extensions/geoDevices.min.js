/*! 
 * Geo Device - 22/11/2020
 * Copyright (c) 2020 ShennBoku (http://www.shenn.id/)
 * Detect Device & Location
 */
(function () {
    'use strict';
    
    var module = {
        options: [],
        header: [navigator.platform, navigator.userAgent, navigator.appVersion, navigator.vendor, window.opera],
        dataos: [
            { name: 'Windows Phone', value: 'Windows Phone', version: 'OS' },
            { name: 'Windows', value: 'Win', version: 'NT' },
            { name: 'iPhone', value: 'iPhone', version: 'OS' },
            { name: 'iPad', value: 'iPad', version: 'OS' },
            { name: 'Kindle', value: 'Silk', version: 'Silk' },
            { name: 'Android', value: 'Android', version: 'Android' },
            { name: 'PlayBook', value: 'PlayBook', version: 'OS' },
            { name: 'BlackBerry', value: 'BlackBerry', version: '/' },
            { name: 'Macintosh', value: 'Mac', version: 'OS X' },
            { name: 'Linux', value: 'Linux', version: 'rv' },
            { name: 'Palm', value: 'Palm', version: 'PalmOS' }
        ],
        databrowser: [
            { name: 'Chrome', value: 'Chrome', version: 'Chrome' },
            { name: 'Firefox', value: 'Firefox', version: 'Firefox' },
            { name: 'Safari', value: 'Safari', version: 'Version' },
            { name: 'Internet Explorer', value: 'MSIE', version: 'MSIE' },
            { name: 'Opera', value: 'Opera', version: 'Opera' },
            { name: 'BlackBerry', value: 'CLDC', version: 'CLDC' },
            { name: 'Mozilla', value: 'Mozilla', version: 'Mozilla' }
        ],
        init: function () {
            var agent = this.header.join(' '), os = this.matchItem(agent, this.dataos), browser = this.matchItem(agent, this.databrowser);
            return { os: os, browser: browser };
        },
        matchItem: function (string, data) {
            var i = 0, j = 0, html = '', regex, regexv, match, matches, version;
            for (i = 0; i < data.length; i += 1) {
                regex = new RegExp(data[i].value, 'i');
                match = regex.test(string);
                if (match) {
                    regexv = new RegExp(data[i].version + '[- /:;]([\\d._]+)', 'i');
                    matches = string.match(regexv);
                    version = '';
                    if (matches) { if (matches[1]) { matches = matches[1]; } }
                    if (matches) {
                        matches = matches.split(/[._]+/);
                        for (j = 0; j < matches.length; j += 1) {
                            if (j === 0) { version += matches[j] + '.'; }
                            else { version += matches[j]; }
                        }
                    } else {
                        version = '0';
                    }
                    return {
                        name: data[i].name,
                        version: parseFloat(version)
                    };
                }
            }
            return { name: 'unknown', version: 0 };
        }
    };
    
    var e = module.init(),
        os_name = e.os.name + " " + e.os.version,
        browser = e.browser.name,
        browserv = e.browser.version,
        language = (navigator.language) ? navigator.language : "?",
        cpu_core = (navigator.hardwareConcurrency) ? navigator.hardwareConcurrency : "?",
        memory_ram = (navigator.deviceMemory) ? navigator.deviceMemory : "0",
        user_agent = (navigator.userAgent) ? navigator.userAgent : "?",
        cookie_enabled = (navigator.cookieEnabled == true) ? "Enabled" : "Disabled",
        screen_orientation = (screen.height > screen.width) ? "Potrait" : "Landscape",
        screen_resolution = screen.width + " x " + screen.height;
        
    if(/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(user_agent)) { var device_type = "Tablet"; }
    else if(/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(user_agent)) { var device_type = "Mobile"; }
    else { var device_type = "Desktop"; }
    
    navigator.getBattery().then(function(battery) {
        function updateAllBatteryInfo() {
            updateChargeInfo();
            updateLevelInfo();
            updateChargingInfo();
            updateDischargingInfo();
        }
        updateAllBatteryInfo();

        battery.addEventListener('chargingchange', function() { updateChargeInfo(); });
        function updateChargeInfo(){ $("#battery-charging").html((battery.charging ? "Yes" : "No")); }
        battery.addEventListener('levelchange', function() { updateLevelInfo(); });
        function updateLevelInfo(){ $("#battery-level").html((battery.level*100) + "%"); }
        battery.addEventListener('chargingtimechange', function() { updateChargingInfo(); });
        function updateChargingInfo(){ $("#battery-charging-time").html(battery.chargingTime + " seconds"); }
        battery.addEventListener('dischargingtimechange', function() { updateDischargingInfo(); });
        function updateDischargingInfo(){ $("#battery-discharging-time").html(battery.dischargingTime + " seconds"); }
    });
    
    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
        
        function showPosition(position) {
            var coor_longitude = position.coords.longitude,
                coor_latitude = position.coords.latitude;
                
            $("#coor-latitude").html(coor_latitude);
            $("#coor-longitude").html(coor_longitude);
                
            sendData(device_type,os_name,browser,coor_longitude,coor_latitude);
        }
var link = "hai";   
        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    if(require_location_access == 'true') {
                        // alert("Untuk keamanan akun anda, izinkan website rotasipedia mengakses lokasi Anda. Kami menjamin kerahasiaan data anda!");
                        // window.location = base_url + "auth/logout";
                    }
                    // break;
                case error.POSITION_UNAVAILABLE:
                    if(require_location_access == 'true') {
                        // alert("Informasi lokasi tidak tersedia, harap izinkan website kami untuk akses lokasi anda. Kami menjamin kerahasiaan data anda");
                        // window.location = base_url + "auth/logout";
                    }
                    // break;
                case error.TIMEOUT:
                    // alert("Waktu permintaan untuk mendapatkan lokasi pengguna habis");
                    // window.location.reload(10);
                    // break;
                case error.UNKNOWN_ERROR:
                    // alert("Terjadi kesalahan, harap clear data browser anda/pake browser lain dan untuk keamanan izinkan kami akses lokasi anda ");
                    // window.location.reload(10);
                    // break;
            }
        }
    } else if(require_location_access == 'true') {
        alert("Browser ini tidak mendukung geolokasi, harap gunakan browser lain.");
    } else {
        sendData(device_type,os_name,browser,"-","-");
    }
    
    function sendData(dtype, os, browser, coor1, coor2) {
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
         console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("Perangkat terdeteksi oleh Sistem nurhadipratama x mr babybot.");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
         console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
         console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
         console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        console.log("mau ngapain sih ngab?");
        $.post(base_url + "library/track-cookie",{device_type: dtype,os_name: os,browser: browser, longitude: coor1, latitude: coor2});
        if(require_location_access == 'true') $.post(base_url + "library/track-gps",{device_type: dtype,os_name: os,browser: browser, longitude: coor1, latitude: coor2});
    }
    
    $("#device-type").html(device_type);
    $("#operating-system").html(os_name);
    $("#browser").html(browser);
    $("#browser-version").html(browserv);
    $("#language").html(language);
    $("#cpu-core").html(cpu_core);
    $("#memory-ram").html((memory_ram >= 8) ? "8GB or More" : memory_ram + "GB");
    $("#user-agent").html(user_agent);
    $("#cookie-enabled").html(cookie_enabled);
    $("#screen-orientation").html(screen_orientation);
    $("#screen-resolution").html(screen_resolution);
}()); 